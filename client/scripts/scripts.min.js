(function($,window,undefined){var pluginName="touchClick";var defaults={className:"active",callback:function(){console.log("touchClick")}};var isTouch=("ontouchend" in window);var touchstartEvent=isTouch?"touchstart."+pluginName:"mousedown."+pluginName;var touchmoveEvent=isTouch?"touchmove."+pluginName:"mousemove."+pluginName;var touchendEvent=isTouch?"touchend."+pluginName:"mouseup."+pluginName;function Plugin(element,className,callback){this.element=element;if(typeof className==="function"){this.options={};this.options.className=defaults.className;this.options.callback=className}else{this.options={className:className||defaults.className,callback:callback||defaults.callback}}this._defaults=defaults;this._name=pluginName;this.init()}Plugin.prototype.init=function(){var self=this;var $element=$(self.element);var className=self.options.className;var callback=self.options.callback;$element.bind(touchstartEvent,function(e){this.touchClickStart=true;$element.addClass(className)}).bind(touchmoveEvent,function(e){if(this.touchClickStart){this.touchClickStart=undefined;$element.removeClass(className)}}).bind(touchendEvent,function(e){var dom=this;if(this.touchClickStart){this.touchClickStart=undefined;$element.removeClass(className);setTimeout(function(){$.proxy(callback,dom)(e)},0)}})};$.fn[pluginName]=function(className,callback){return this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new Plugin(this,className,callback))}})}})(jQuery,window);

var $thumbs = $('#albisThumbs li');

jQuery.fn.testfunc = function() {
	 
	var $frame = $('#albisWall figure'),
		$frameNumber = $frame.length,
		$lastFrame = $frameNumber - 1,
		$thisFrame = 0,
		$nextFrame = 0,
		$prevFrame = 0,
		$overlay = $('#albisOverlay'),
		$prev = $overlay.find('#prev'),
		$next = $overlay.find('#next'),
		$exit = $overlay.find('#exit'),
		$piccountercode = '<p id="piccounter">Bild <span id="picnumber"></span> von <span id="allpics">' + $frameNumber + '</span></p>',
		$picnumber = 0,
		$piccounter = 0,
		$wall = $('#albisWall');
	
	// Aufruf der Galerie
		
	$thumbs.touchClick(function() {
		// zählt die Bilder
		$thisFrame = $thumbs.index(this);
		// verändert Position und speichert den Wert von $thisFrame
		$wall.css('left',(-$thisFrame*100)+'%').data('frame', $thisFrame);
		// blendet die Galerie ein
		$overlay.addClass('visible').prepend($piccountercode);
		$piccounter = $('#piccounter');
		$picnumber = $('#picnumber');
		piccount();
		// Verhalten beim letzten Bild
		if ($thisFrame == ($lastFrame) ) {
			$wall.addClass('lastframe');
			$next.hide();
		}
		// Verhalten beim ersten Bild
		if ($thisFrame == 0 ) {
			$wall.addClass('firstframe');
			$prev.hide();
		}
	});
	
	// voräwrts schalten	
	$prev.touchClick(function () {
	 	prepShow();
	 	showPrev();
	});
	
	// rückwärts schalten
	$next.touchClick(function () {
	 	prepShow();
	 	showNext();
	});
	
	// Galerie schließen
	$exit.touchClick(function () {
	 	exitGallery();
	});
	

	function prepShow(){
		// liest Nummer des Bildes aus gespeicherten Daten	
		$thisFrame = $wall.data('frame');
		// löst die CSS-Animation aus
		$overlay.addClass('slide');
	}
	
	function showNext(){
		if($thisFrame < 0 || $thisFrame >= $lastFrame){
			return false;
		}
		else {
			// ermittelt nächstes Bild
			$nextFrame = $thisFrame + 1;
			// verändert die Position des Rahmens, speichert die Bildnummer für das nächste Bild
			$wall.css('left',(-$nextFrame*100)+'%').data("frame", $nextFrame);
			piccount();
			if ($thisFrame == ($lastFrame - 1) ) {
				// schreibt extre class bei Ereichen des letzten Bildes
				$wall.addClass('lastframe');
				// versteckt weiter-Button	
				$next.hide();
			}
			if 	('$prev:hidden') {
				// Blendet zurück-Botton bei Bedarf ein
				$prev.show();
			}
		}
	}
	
	function showPrev(){
		if($thisFrame < 1 || $thisFrame > $lastFrame){
			return false;
		}
		else {
			// ermittelt voriges Bild
			$prevFrame = $thisFrame - 1;
			// verändert die Position des Rahmens, speichert die Bildnummer für das vorigen Bild
			$wall.css('left',(-$prevFrame*100)+'%').data("frame", $prevFrame);
			piccount();
			if ($thisFrame == 1 ) {
				// schreibt extre class bei Ereichen des ersten Bildes
				$wall.addClass('firstframe');
				// versteckt zurück-Button	
				$prev.hide();
			}
			if ('$next:hidden') {
				// Blendet vorwärts-Botton bei Bedarf ein
				$next.show();
			}
			
		}
	}

	function exitGallery(){
		// löscht die class
		$overlay.removeClass('visible slide');
		// löscht Bilderzähler
		$piccounter.remove();
		// zeigt ausgeblendete Buttons wieder ein
		// $('button').show();
	}
	
	function piccount() {
		// aktuelle Nummer des Bildes (Start bei 1) in den Bilderzähler schreiben
		$picnumber.empty().prepend($wall.data('frame')+1);
	}
};


$(document).ready (function () {
	$thumbs.testfunc();
}); // end ready

//$('.frame').touchClick(thisFrame) {
//	alert(index);
//};
	
// alert ($frameNumber);

/*

function removeover() {
	$('#overlay').remove();
}

function showover() {
	$('body').append('<div id="overlay"></div>');
	$("#overlay").touchClick(removeover);
}


$('#showover').touchClick(showover);

*/